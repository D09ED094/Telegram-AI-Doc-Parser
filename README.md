# Telegram-AI-Doc-Parser
*Telegram бот для извлечения данных из PDF с помощью Google Gemini AI и генерации ультра-сжатых сводок.*

## Описание Проекта
`Telegram-AI-Doc-Parser` — это Python-бот для Telegram, разработанный для автоматического анализа PDF-документов. Бот извлекает текстовую информацию из загруженных PDF-файлов и использует модель Google Gemini AI для создания детализированных, но ультра-сжатых сводок о людях, упомянутых в документах. Особенностью является динамическое применение шаблонов сводок, зависящих от возраста лица (для лиц младше 18 лет и 18 лет и старше). Бот также предлагает удобное меню настроек для управления ключами API Gemini и отслеживания лимитов использования.

## Ключевые Возможности
*   **Автоматическое Извлечение Текста:** Парсинг содержимого PDF-файлов с помощью `pypdf`.
*   **Интеллектуальная Суммаризация:** Использование Google Gemini AI (`gemini-2.5-flash`) для генерации информативных сводок.
*   **Динамические Шаблоны Сводок:** Два адаптированных шаблона для краткого изложения информации о взрослых и несовершеннолетних лицах.
*   **Автоматическое Формирование Промптов:** Бот умеет использовать имя файла для генерации запроса к AI, если пользователь не указал свой промт.
*   **Управление API-Ключами:** Возможность переключения между несколькими ключами Google Gemini AI через Inline-кнопки.
*   **Отслеживание Лимитов:** Отображение информации о лимитах запросов в день (RPD) и времени до их сброса, с учетом часовых поясов.
*   **Интерактивный Интерфейс:** Удобные inline-кнопки для навигации и настроек.

## Установка и Запуск

### 1. Клонирование Репозитория
```bash
git clone https://github.com/D09ED094/Telegram-AI-Doc-Parser.git
cd Telegram-AI-Doc-Parser
```

### 2. Установка Зависимостей
Используйте `pip` для установки необходимых библиотек:
```bash
pip install python-telegram-bot google-generativeai pypdf
```

### 3. Настройка Переменных Окружения
Для работы бота необходимы токены Telegram и ключи Google Gemini API.

В вашем коде Python переменные окружения будут загружены следующим образом (пример из файла):
```python
TELEGRAM_BOT_TOKEN = "токен бота тг"
MODEL_NAME = 'gemini-2.5-flash'

# Список доступных ключей для переключения
AVAILABLE_KEYS = {
    "Основной": "ключь джеминай",
    "Доп. ключ": "ключь джеминай"
}
```
Убедитесь, что имена переменных в вашем `.env` файле (например, `GEMINI_API_KEY_MAIN`) соответствуют тем, которые вы используете в `os.getenv()` в коде.

### 4. Запуск Бота
```bash
python main.py
```

## Использование Бота

1.  **Запуск:** Отправьте боту команду `/start`. Вы получите приветственное сообщение с инструкциями и кнопкой "⚙️ Настройки".
2.  **Отправка PDF:** Просто отправьте боту один PDF-файл.
    *   Бот автоматически извлечет текст.
    *   Использует имя файла для автоматического формирования запроса к AI (например, если файл `Иванов_Иван.pdf`, бот будет искать информацию об Иванове Иване).
    *   Если вы хотите задать свой собственный запрос, отправьте PDF с подписью. Бот будет использовать вашу подпись в дополнение к информации из имени файла.
    *   Бот обработает только первый PDF, если вы отправите несколько.
3.  **Настройки:** Нажмите "⚙️ Настройки", чтобы:
    *   Просмотреть текущие лимиты Google Gemini API (RPM, TPM, RPD).
    *   Узнать время до сброса дневного лимита (RPD) по МСК.
    *   Переключиться между доступными ключами Gemini API. Активный ключ будет отмечен галочкой.

## Особенности Промптинга и Структура Сводок
Бот использует продвинутый унифицированный промпт для Google Gemini, который динамически выбирает структуру сводки на основе возраста человека, найденного в документе:

*   **Структура 1 (Для лиц младше 18 лет):** Фокусируется на ФИО, дате рождения, месте рождения, контактах (часто родительских), сфере занятости (например, образование), классном руководителе, родителях и братьях/сестрах.
*   **Структура 2 (Для лиц 18 лет и старше):** Содержит более подробную информацию: ФИО, дата рождения, место рождения, адрес прописки/фактический, идентификаторы (Паспорт, СНИЛС, ИНН с процентом совпадения), контакты, данные о работе/финансах и семье (супруг, дети).

> [!TIP] Оптимизация промпта
> Встроенный промпт включает строгие правила форматирования (например, отступы, эмодзи) и логику пропуска пустых полей/секций, что обеспечивает ультра-сжатость и единообразие выходных данных. Максимальный размер текста для Gemini ограничен 100 000 символами.

## Логика Отслеживания Лимитов
Бот рассчитывает время до сброса ежедневного лимита запросов (RPD) для Google Gemini API, который обычно обновляется в 00:00 PDT (Тихоокеанское летнее время, UTC-7). Информация отображается в удобном для пользователя формате (время по МСК и оставшееся время).

> [!INFO] Важность RPD
> Google Gemini API имеет ограничения на количество запросов в минуту (RPM), токенов в минуту (TPM) и запросов в день (RPD). Следите за этими лимитами, чтобы обеспечить бесперебойную работу бота. Переключение между несколькими ключами может помочь обойти дневной лимит, но не отменяет его.

## Разработка
Проект написан на Python с использованием библиотеки `python-telegram-bot` для взаимодействия с Telegram API и `google-generativeai` для интеграции с Google Gemini. Для парсинга PDF используется `pypdf`.
